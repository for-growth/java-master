# 4장. 함수형 데이터 처리

<br>

## 4.1 스트림이란 무엇인가?

- 스트림을 이용하면 선언형으로 컬렉션 데이터를 처리할 수 있음
- 스트림을 이용하여 데이터를 투명하게 병렬로 처리할 수 있음
- `filter` 같은 연산은 고수준 빌딩 블록으로 이루어져 있으므로 특정 스레딩 모델에 제한되지 않고 자유롭게 사용할 수 있음
- 특징
    - 선언형 : 더 간결하고 가독성이 좋아짐
    - 조립할 수 있음 : 유연함
    - 병렬화 : 성능이 좋아짐

<br>
<hr>

## 4.2 스트림 시작하기

> 스트림 : 데이터 처리 연산을 지원하도록 소스에서 추출된 연속된 요소
>
- 연속된 요소 : 특정 요소 형식으로 이루어진 연속된 값 집합의 인터페이스. 표현 계산식이 주를 이룸
- 소스 : 컬렉션, 배열, IO 자원 등의 데이터 제공 소스
- 데이터 처리 연산 : 함수형 프로그래밍 언어에서 일반적으로 지원하는 연산과 DB 와 비슷한 연산을 지원. 스트림 연산은 순차적 또는 병렬로 실행할 수 있음
- 파이프라이닝 : 스트림 연산끼리 연결해서 커다란 파이프 라인을 구성할 수 있도록 스트림 반환
- 내부 반복 : 반복자를 이용해서 명시적으로 반복하는 것이 아닌 내부적으로 반복함

```java
List<String> threeCaloriesDishNames = 
	menu.stream()          //스트림 얻기
			.filter(dish -> dish.getcalories() > 300)  //파이프라인 연산 만들기 - 필터링
			.map(Dish::getName)                        //요리명 추출
			.limit(3)                                  //선착순 3개 선택
			.collect(toList());                        //결과를 다른 리스트로 저장
```

- `filter` : 람다를 인수로 받아 스트림에서 특정 요소를 제외
- `map` : 람다를 이용하여 한 요소를 다른 요소로 변환하거나 정보를 추출
- `limit` : 정해진 개수 이상의 요소가 스트림에 저장되지 못하게 스트림 크기를 축소
- `collect` : 스트림을 다른 형식으로 변환

<br>
<hr>

## 4.3 스트림과 컬렉션

- 데이터를 언제 계산하는지가 스트림과 컬렉션의 가장 큰 차이
- 컬렉션은 현재 자료구조가 포함하는 모든 값을 메모리에 저장
- 스트림은 요청할 때만 요소를 계산하는 고정된 자료구조
    - 게으른 생성 : 필요할때만 값을 계산 → ex) 스트리밍 서비스

<br>

### 4.3.1 딱 한번만 탐색할 수 있다

- 스트림은 한번만 탐색할 수 있음 → 탐색된 스트림의 요소는 소비됨
- 다시 탐색하려면 데이터 소스에서 새로운 스트림을 만들어야함

<br>

### 4.3.2 외부 반복과 내부 반복

- 컬렉션은 `for-each` 등을 통해서 직접 요소를 반복해야함 → **외부 반복**
- 스트림은 반복을 알아서 처리하고 결과 스트림 값을 어딘가에 저장 → **내부 반복**
- 내부 반복을 이용하면 작업을 투명하게 병렬로 처리하거나 더 최적화된 다양한 순서로 처리할 수 있음
    - `for-each` 를 사용한다면 병렬성을 스스로 관리해야함

<br>
<hr>

## 4.4 스트림 연산

- 스트림은 연결할 수 있는 중간 연산, 스트림을 닫는 최종 연산이 있음

### 4.4.1 중간 연산

- `filter` 나 `sorted` 같은 중간 연산은 다른 스트림을 반환 → 여러 중간 연산을 연결해서 질의를 만들 수 있음
- 단말 연산을 스트림 파이프라인에 실행하기 전까지는 아무 연산을 실행하지 않음 → 게으름
- 모든 중간 연산을 합친다음 최종 연산으로 한번에 처리
- 특정 요소로 제한하는것 → limit 연산, 쇼트 서킷
- 여러 연산을 한 과정으로 병합 → 루프 퓨전

<br>

### 4.4.2 최종 연산

- 스트림 파이프라인에서 결과를 도출
- `List`, `Integer`, `void` 등 다양한 타입으로 결과가 반환

<br>

### 4.4.3 스트림 이용하기

- 3단계
    - 질의를 수행할 데이터 소스
    - 스트림 파이프라인을 구성할 중간 연산 연결
    - 스트림 파이프라인을 실행하고 결과를 만들 최종 연산
- 스트림 파이프라인의 개념을 빌더 패턴과 비슷
- 중간 연산 종류 : `filter`, `map`, `limit`, `sorted`, `distinct`
- 최종 연산 종류 : `forEach`, `count`, `collect`

<br>
<hr>

## 4.5 로드맵

- 5장에서 사례 및 패턴 볼 예정

## 4.6 마치며

- 스트림은 소스에서 추출된 연속 요소로 데이터 처리 연산을 지원
- 스트림은 내부 반복을 지원. 내부 반복은 filter, map, sorted 등의 연산으로 반복을 추상화
- 스트림에는 중간 연산과 최종 연산이 있음
- 중산 연산은 filter 와 map 처럼 스트림을 반환하면서 다른 연산과 연결되는 연산. 중간 연산으로 파이프라인을 주성할 수는 있지만 결과를 생성할수는 없음
- forEach 나 count 처럼 스트림 파이프 라인을 처리해서 스트림이 아닌 결과를 반환하는 연산을 최종연산이라고 함
- 스트림의 요소는 요청할때 게으르게 계산됨

<br>
<br>